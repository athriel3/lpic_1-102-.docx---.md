**108.1 Управление системным временем**

Студент должен уметь управлять системным временем и синхронизировать
часы при помощи NTP.

**Изучаем**:

- установку даты и времени;

- настройку часов на точнее время в формате UTC;

- настройку часового пояса;

- базовую конфигурацию NTP;

- сервис pool.ntp.org;

- команду ntpq.

В операционной системе время определяется [четырьмя]{.underline}
параметрами: значение времени, стандарт (UTC или местное), часовой пояс
и наличие перехода на летнее время. По сути на ПК есть два вида часов:

- **Часы реального времени** (RTC), представляющие собой схему на плате
  (управляются командой ***hwclock***);

- **Системные часы** (программные часы), которые берут время при старте
  ОС из аппаратных часов (посмотреть их значение можно командой
  ***date***).

Все доступные часовые пояса находятся в директории
***/usr/share/zoneinfo/***. Для указания временной зоны создается ссылка
***/etc/localtime*** на файл из этой директории (в Ubuntu не так). При
этом в некоторых дистрибутивах есть файл ***/etc/timezone*** в котором
простым текстом указана текущая временная зона.

Для настройки временной зоны в Ubuntu проще всего выполнить команду
***dpkg-reconfigure tzdata***

При ручной синхронизации часов создается файл ***/etc/adjtime***,
который в дальнейшем используется для автоматической подстройки часов.
Аппаратные часы можно подстроить командой ***hwclock \--adjust***

Аппаратное время можно настраивать следующими командами:

- ***Sudo hwclock \--set \--date="01/01/2020 12:00"***

- ***Sudo hwclock --w*** (синхронизировать с системным)

- ***Sudo hwclock --u --w*** (хранить время в UTC)

- ***Sudo hwclock --localtime*** (хранить время в локальном стандарте)

**NTP** -- сетевой протокол синхронизации времени, разработанный для
работы с разной латентностью среды передачи (подходит для сети
интернет).

Проект [[http://www.pool.ntp.org]{.underline}](http://www.pool.ntp.org/)
показывает доступные для синхронизации сервера времени в интернете.
Можно вручную синхронизировать время с пулом следующей командой (будет
выбран случайный доступный сервер из пула):

- ***Sudo ntpdate 0.ru.pool.ntp.org***

Для автоматической синхронизации времени используется демон **ntpd,**
который настраивается в файле конфигурации ***/etc/ntp.conf***,
например, добавлением строчки

- ***server ntp.ubuntu.com*** (использовать указанный сервер времени для
  синхронизации).

Команда **ntpq** позволяет запросить информацию с серверов времени и
вывести результат в виде таблицы, например:

- ***ntpq --np*** (вывести состояние серверов синхронизации в цифровом
  формате).

Время по часовым поясам разложено в директории ***/usr/share/zoneinfo***
в двоичном формате. Для просмотра файлов в этой директории необходимо
воспользоваться командой ***zdump***. Классическая настройка часового
пояса заключается в создании ссылки ***/etc/localtime*** ведущей на файл
в директории ***/usr/share/zoneinfo***, например:

- ***ln -sf /usr/share/zoneinfo/Europe/Kiev*** ***/etc/localtime***

В Ubuntu такой ссылки нет и установка часового пояса осуществляется
настройкой базы данных tzdata командой ***sudo
dpkg-reconfigure tzdata.***

Также в Ubuntu можно посмотреть текущий часовой пояс в файле
***/etc/timezone***

В последних версиях Linux все чаще для установки часового пояса, даты и
времени используется команда ***timedatectl***. У нее довольно много
ключей, например:

⮚ ***timedatectl set-time \"2012-10-30 18:17:16\"***

⮚ ***timedatectl list-timezones***

⮚ ***timedatectl set-timezone America/Los_Angeles***
